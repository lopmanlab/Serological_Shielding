temp.test
source('C:/Users/czhao/Desktop/Generating Microbiome-like Data/05-26-2020_Generating_Microboime-like_Data.R')
source('C:/Users/czhao/Desktop/Generating Microbiome-like Data/05-26-2020_Generating_Microboime-like_Data.R')
temp.test
require(parallel)
remove('parallel')
remove.packages('parallel')
require(parallel)
detach('package:parallel', unload = TRUE)
# parallelized
cl = makeCluster(7)
registerDoParallel(cl)
foreach(i = 1:pars$N^2) %do% {
res = ode(y = pars$N0s[,i], times = ts, GLV_sim, pars)
return(res[nrow(res),-1])
}
stopCluster(cl)
require(foreach)
require(doParallel)
# parallelized
cl = makeCluster(7)
registerDoParallel(cl)
foreach(i = 1:pars$N^2) %do% {
res = ode(y = pars$N0s[,i], times = ts, GLV_sim, pars)
return(res[nrow(res),-1])
}
stopCluster(cl)
foreach(i = 1:pars$N^2, .combine = 'rbind') %do% {
res = ode(y = pars$N0s[,i], times = ts, GLV_sim, pars)
return(res[nrow(res),-1])
}
df.res = as.data.frame(t(temp.test_par), stringsAsFactors = F)
temp.test_par = foreach(i = 1:pars$N^2, .combine = 'rbind') %do% {
res = ode(y = pars$N0s[,i], times = ts, GLV_sim, pars)
return(res[nrow(res),-1])
}
df.res = as.data.frame(t(temp.test_par), stringsAsFactors = F)
cl = makeCluster(7)
registerDoParallel(cl)
temp.test_par = foreach(i = 1:pars$N^2, .combine = 'rbind') %do% {
res = ode(y = pars$N0s[,i], times = ts, GLV_sim, pars)
return(res[nrow(res),-1])
}
stopCluster(cl)
df.res = as.data.frame(t(temp.test_par), stringsAsFactors = F)
require(doParallel)
# parallelized
cl = makeCluster(7)
cl
source('C:/Users/czhao/Desktop/Generating Microbiome-like Data/05-26-2020_Generating_Microboime-like_Data.R')
install.packages('parallel')
install.packages("parallel")
require(Rtools)
install.packages('Rtools')
library(parallel)
sessionInfo(0)
sessionInfo()
install.packages('installr')
reuqire(installr)
updateR()
require(installr)
updateR()
updateR()
require(readxl)
derp = list(1, 1:2, 2)
derp
derp[c(T, F, T)]
derp[[T, F, T]]
derp[[c(T, F, T)]]
isntall.packages('rethinking')
install.packages('rethinking')
install.packages(c("coda","mvtnorm","devtools","loo","dagitty"))
library(devtools)
devtools::install_github("rmcelreath/rethinking")
install.packages(c('fs', 'usethis'))
install.packages('memoise')
install.packages(c("coda","mvtnorm","devtools","loo","dagitty"))
library(devtools)
devtools::install_github("rmcelreath/rethinking")
install.packages('callr')
require(evtools)
require(devtools)
install.packages('processx')
require(devtools)
require(devtools)
install.packages('devtools')
install.packages('Rtools')
require(rethinking)
install.packages('rstan')
require(rethinking)
install.packages('inline')
require(rethinking)
install.packages('rstan')
require(rethinking)
install
require('rstan')
install.packages('rethinking')
require(rethinking)
# create a list of all installed packages
ip <- as.data.frame(installed.packages())
head(ip)
# if you use MRO, make sure that no packages in this library will be removed
ip <- subset(ip, !grepl("MRO", ip$LibPath))
# we don't want to remove base or recommended packages either\
ip <- ip[!(ip[,"Priority"] %in% c("base", "recommended")),]
# determine the library where the packages are installed
path.lib <- unique(ip$LibPath)
# create a vector with all the names of the packages you want to remove
pkgs.to.remove <- ip[,1]
head(pkgs.to.remove)
# remove the packages
sapply(pkgs.to.remove, remove.packages, lib = path.lib)
install.packages(c("coda","mvtnorm","devtools","loo","dagitty"))
library(devtools)
devtools::install_github("rmcelreath/rethinking")
# create a list of all installed packages
ip <- as.data.frame(installed.packages())
head(ip)
# if you use MRO, make sure that no packages in this library will be removed
ip <- subset(ip, !grepl("MRO", ip$LibPath))
# we don't want to remove base or recommended packages either\
ip <- ip[!(ip[,"Priority"] %in% c("base", "recommended")),]
# determine the library where the packages are installed
path.lib <- unique(ip$LibPath)
# create a vector with all the names of the packages you want to remove
pkgs.to.remove <- ip[,1]
head(pkgs.to.remove)
# remove the packages
sapply(pkgs.to.remove, remove.packages, lib = path.lib)
install.packages(c("coda","mvtnorm","devtools","loo","dagitty"))
library(devtools)
devtools::install_github("rmcelreath/rethinking")
install.packages('backports')
install.packages("backports")
devtools::install_github("rmcelreath/rethinking")
devtools::install_github("rmcelreath/rethinking")
require(rethinking)
install.packages('reshape2')
install.packages("phyloseq")
require(rethinking)
data("reedfrogs")
d = reedfrogs
str(d)
View(d)
d$tank = 1:nrow(d)
dat = list(S = d$surv, N = d$density, tank = d$tank)
dat
m13.1 = ulam(alist(S~dbinom(N,p),
logit(p) = a[tank],
a[tank] ~ dnorm(0, 1.5)
), data=dat, chains=4, log_lik=TRUE)
m13.1 = ulam(alist(S~dbinom(N,p), logit(p) = a[tank], a[tank] ~ dnorm(0, 1.5)), data=dat, chains=4, log_lik=TRUE)
m13.1 = ulam(alist(S~dbinom(N,p)
, logit(p) = a[tank]
, a[tank] ~ dnorm(0, 1.5))
, data=dat, chains=4, log_lik=TRUE)
m13.1 = ulam(alist(S~dbinom(N,p)
, logit(p) = a[tank]
, a[tank] ~ dnorm(0, 1.5))
, data=dat, chains=4
, log_lik=TRUE)
m13.1 = ulam(alist(S~dbinom(N,p)
, logit(p) = a[tank]
, a[tank] ~ dnorm(0, 1.5))
, data=dat
, chains=4
, log_lik=TRUE)
m13.1 = ulam(alist(
S~dbinom(N,p)
, logit(p) = a[tank]
, a[tank] ~ dnorm(0, 1.5))
, data=dat
, chains=4
, log_lik=TRUE)
m13.1 = ulam(alist(
S ~ dbinom(N,p),
logit(p) = a[tank],
a[tank] ~ dnorm(0, 1.5)
)
, data=dat
, chains=4
, log_lik=TRUE)
m13.1 = ulam(alist(
S ~ dbinom(N,p),
logit(p) = a[tank],
a[tank] ~ dnorm(0, 1.5)
)
, data=dat
, chains=4
, log_lik=TRUE)
m13.1 = ulam(alist(
S ~ dbinom(N,p),
logit(p) = a[tank],
a[tank] ~ dnorm(0, 1.5)
)
, data=dat
, chains=4
, log_lik=TRUE)
m13.1 = ulam(alist(
S ~ dbinom(N,p),
logit(p) <= a[tank],
a[tank] ~ dnorm(0, 1.5)
)
, data=dat
, chains=4
, log_lik=TRUE)
m13.1 = ulam(alist(
S ~ dbinom(N,p),
logit(p) <- a[tank],
a[tank] ~ dnorm(0, 1.5)
)
, data=dat
, chains=4
, log_lik=TRUE)
precis(m13.1, depth=2)
m13.2 = ulam(
alist(
S~dbinom(N,P),
logit(p) <- a[tank],
a[tank] ~ dnorm(a_bar, sigma),
a_bar ~ dnorm(0,1.5),
sigma ~ dexp(1)
), data=dat, chains=4, log_lik=TRUE
)
m13.2 = ulam(
alist(
S~dbinom(N,p),
logit(p) <- a[tank],
a[tank] ~ dnorm(a_bar, sigma),
a_bar ~ dnorm(0,1.5),
sigma ~ dexp(1)
), data=dat, chains=4, log_lik=TRUE
)
writeLines('PATH="${RTOOLS40_HOME}\\usr\\bin;${PATH}"', con = "~/.Renviron")
Sys.which("make")
install.packages("jsonlite", type = "source")
remove.packages("rstan")
if (file.exists(".RData")) file.remove(".RData")
restart
uninstall('StanHeaders')
remove.packages("rstan")
if (file.exists(".RData")) file.remove(".RData")
remove.packages('StanHeaders')
install.packages(
"https://win-builder.r-project.org/9ziTrYx8Be28/StanHeaders_2.21.0-6.zip",
repos = NULL, type = "win.binary")
install.packages(
"https://win-builder.r-project.org/NSucX8f7MS6s/rstan_2.21.2.zip",
repos = NULL, type = "win.binary")
remove.packages("rstan")
if (file.exists(".RData")) file.remove(".RData")
remove.packages('StanHeaders')
install.packages(
"https://win-builder.r-project.org/gdaEAY9p8V7I/StanHeaders_2.21.0-6.zip",
repos = NULL, type = "win.binary")
install.packages(
"https://win-builder.r-project.org/iT79L894j228/rstan_2.21.2.zip",
repos = NULL, type = "win.binary")
CXX14FLAGS=-O3 -mtune=native -mmmx -msse -msse2 -msse3 -mssse3 -msse4.1 -msse4.2
dotR <- file.path(Sys.getenv("HOME"), ".R")
if (!file.exists(dotR)) dir.create(dotR)
M <- file.path(dotR, ifelse(.Platform$OS.type == "windows", "Makevars.win", "Makevars"))
if (!file.exists(M)) file.create(M)
file.edit("~/.R/Makevars.win")
getwd
getwd(0)
getwd()
setwd('CYZ GITHUB/Weitz Group/COVID-19/Lopman COVID collab/')
ls
ls.dir
list.dirs()
setwd('Serological_Shielding/')
ls
setwd('Learning_MCMCs/')
require(rstan)
# options(mc.cores = parallel::detectCores())
# rstan_options(auto_write = TRUE)
# Sys.setenv(LOCAL_CPPFLAGS = '-march=native -mtune=native')
schools_dat <- list(J = 8,
y = c(28,  8, -3,  7, -1,  1, 18, 12),
sigma = c(15, 10, 16, 11,  9, 11, 10, 18))
fit <- stan(file = 'schools.stan', data = schools_dat)
print(fit)
plot(fit)
pairs(fit, pars = c("mu", "tau", "lp__"))
la <- extract(fit, permuted = TRUE) # return a list of arrays
mu <- la$mu
### return an array of three dimensions: iterations, chains, parameters
a <- extract(fit, permuted = FALSE)
### use S3 functions on stanfit objects
a2 <- as.array(fit)
m <- as.matrix(fit)
a2
m
d
d
d <- as.data.frame(fit)
head(d)
y <- as.matrix(read.table('https://raw.github.com/wiki/stan-dev/rstan/rats.txt', header = TRUE))
x <- c(8, 15, 22, 29, 36)
xbar <- mean(x)
N <- nrow(y)
T <- ncol(y)
rats_fit <- stan('https://raw.githubusercontent.com/stan-dev/example-models/master/bugs_examples/vol1/rats/rats.stan')
y <- as.matrix(read.table('rats.txt', header = TRUE))
x <- c(8, 15, 22, 29, 36)
xbar <- mean(x)
N <- nrow(y)
T <- ncol(y)
rats_fit <- stan('rats.stan')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman COVID collab/Serological_Shielding/Learning_MCMCs/test_mcmcpack.R')
logitfun <- function(beta){
eta <- X %*% beta
p <- 1.0/(1.0+exp(-eta))
sum( y * log(p) + (1-y)*log(1-p) )
}
x1 <- rnorm(1000)
x2 <- rnorm(1000)
Xdata <- cbind(1,x1,x2)
p <- exp(.5 - x1 + x2)/(1+exp(.5 - x1 + x2))
yvector <- rbinom(1000, 1, p)
yvector
post.samp <- MCMCmetrop1R(logitfun, theta.init=c(0,0,0),
X=Xdata, y=yvector,
thin=1, mcmc=40000, burnin=500,
tune=c(1.5, 1.5, 1.5),
verbose=TRUE, logfun=TRUE, optim.maxit=100)
?MCMCmetrop1R
X=Xdata
y=yvector
post.samp <- MCMCmetrop1R(logitfun
, theta.init=c(0,0,0)
, thin=1
, mcmc=40000
, burnin=500
, tune=c(1.5, 1.5, 1.5)
, verbose=TRUE
, logfun=TRUE
, optim.maxit=100)
## logistic regression with an improper uniform prior
## X and y are now in the global environment
.
logitfun <- function(beta){
eta <- X %*% beta
p <- 1.0/(1.0+exp(-eta))
sum( y * log(p) + (1-y)*log(1-p) )
}
x1 <- rnorm(1000)
x2 <- rnorm(1000)
X <- cbind(1,x1,x2)
p <- exp(.5 - x1 + x2)/(1+exp(.5 - x1 + x2))
y <- rbinom(1000, 1, p)
post.samp <- MCMCmetrop1R(logitfun, theta.init=c(0,0,0),
thin=1, mcmc=40000, burnin=500,
tune=c(1.5, 1.5, 1.5),
verbose=TRUE, logfun=TRUE)
raftery.diag(post.samp)
plot(post.samp)
summary(post.samp)
NYC<-read.csv('C://Users/czhao/Documents/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/data/nyc.csv')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/Learning_MCMCs/FittingForConan_NYC.R')
sum(lik)
ggplot(data=NYC)+geom_line(aes(x=X, y=wkdeaths))+
geom_line(aes(x=X, y=DeathsModeled), linetype=2)
WeekDeaths
require(MCMCpack)
setwd('/Users/czhao/Documents/CYZ GITHUB/Weitz Group/COVID-19/Lopman COVID collab/Serological_Shielding/')
source('CYZ_reorg/R/input_SD_Simulations.R')
# Get Pars
pars_doNothing = pars_default
pars_doNothing[['socialDistancing_other']]=0.25
pars_doNothing[['socialDistancing_other_c']]=0.25
pars_doNothing[['p_reduced']]=0.1
pars_doNothing[['p_reduced_c']]=0.1
pars_doNothing[['daily_tests']]=0
pars_doNothing[['tStart_distancing']]=500
pars_doNothing[['tStart_test']]=500
pars_doNothing[['tStart_target']]=500
pars_doNothing[['tStart_school']]=500
pars_doNothing[['tStart_reopen']]=500
# Run Model
model_out = ode(y = X0
, times = pars_doNothing$times
, fun = seir_model_shields_rcfc_nolatent
, parms = pars_doNothing
, method='ode45')
model_out = as.data.frame(model_out)[,-1]
# Extract weekly
y_base = rowSums(model_out[, pars_doNothing$D_ids])/pars_doNothing$N
# Infected=pars_doNothing$N - sum(model_out[366, c(pars_doNothing$S_ids, pars_doNothing$S_pos_ids)])
# Pinfect=Infected/pars_doNothing$N
# Infected; Pinfect
#
# Deaths=sum(model_out[366, pars_doNothing$D_ids])
# Deaths
require(MCMCpack)
setwd('/Users/czhao/Documents/CYZ GITHUB/Weitz Group/COVID-19/Lopman COVID collab/Serological_Shielding/')
source('CYZ_reorg/R/input_SD_Simulations.R')
# Get Pars
pars_doNothing = pars_default
pars_doNothing[['socialDistancing_other']]=0.25
pars_doNothing[['socialDistancing_other_c']]=0.25
pars_doNothing[['p_reduced']]=0.1
pars_doNothing[['p_reduced_c']]=0.1
pars_doNothing[['daily_tests']]=0
pars_doNothing[['tStart_distancing']]=500
pars_doNothing[['tStart_test']]=500
pars_doNothing[['tStart_target']]=500
pars_doNothing[['tStart_school']]=500
pars_doNothing[['tStart_reopen']]=500
# Run Model
model_out = ode(y = X0
, times = pars_doNothing$times
, fun = seir_model_shields_rcfc_nolatent
, parms = pars_doNothing
, method='ode45')
model_out = as.data.frame(model_out)[,-1]
# Extract weekly
y_base = rowSums(model_out[, pars_doNothing$D_ids])/pars_doNothing$N
# Infected=pars_doNothing$N - sum(model_out[366, c(pars_doNothing$S_ids, pars_doNothing$S_pos_ids)])
# Pinfect=Infected/pars_doNothing$N
# Infected; Pinfect
#
# Deaths=sum(model_out[366, pars_doNothing$D_ids])
# Deaths
require(MCMCpack)
setwd('/Users/czhao/Documents/CYZ GITHUB/Weitz Group/COVID-19/Lopman COVID collab/Serological_Shielding/')
source('CYZ_reorg/R/input_SD_Simulations.R')
# Get Pars
pars_doNothing = pars_default
pars_doNothing[['socialDistancing_other']]=0.25
pars_doNothing[['socialDistancing_other_c']]=0.25
pars_doNothing[['p_reduced']]=0.1
pars_doNothing[['p_reduced_c']]=0.1
pars_doNothing[['daily_tests']]=0
pars_doNothing[['tStart_distancing']]=500
pars_doNothing[['tStart_test']]=500
pars_doNothing[['tStart_target']]=500
pars_doNothing[['tStart_school']]=500
pars_doNothing[['tStart_reopen']]=500
# Run Model
model_out = ode(y = X0
, times = pars_doNothing$times
, fun = seir_model_shields_rcfc_nolatent
, parms = pars_doNothing
, method='ode45')
model_out = as.data.frame(model_out)[,-1]
# Extract weekly
y_base = rowSums(model_out[, pars_doNothing$D_ids])/pars_doNothing$N
##  negative binomial regression with an improper unform prior
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
getwd()
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
getwd() != PATH
getwd()
PATH
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
lik
y_base
split(y_base, rep(1:(length(y_base)/7), each=7))
lapply(split(y_base, rep(1:(length(y_base)/7), each=7)), sum)
unlist(lapply(split(y_base, rep(1:(length(y_base)/7), each=7)), sum))
length(y_base)
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
y_base_byWeek
# Extract weekly
y_base = rowSums(model_out[, pars_doNothing$D_ids])#/pars_doNothing$N
y_base_byWeek = unlist(lapply(split(y_base, rep(1:(length(y_base)/7), each=7)), sum))
plot(y_base_byWeek)
y_base_rates_byWeek = y_base_byWeek[2:length(y_base_byWeek)]-y_base_byWeek[(2:length(y_base_byWeek))-1]
y_base_rates_byWeek
y_base.
y_base
head(model_out[, pars_doNothing$D_ids])
NYC
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
WeekDeaths
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
y_rates = y_base[2:length(y_base)] - y_base[1:(length(y_base)-1)]
y_rates
plot(y_rates)
plot(y_rates, y_base)
plot(y_rates, y_base[2:length(y_base)])
# Extract weekly
y_base = rowSums(model_out[, pars_doNothing$D_ids])#/pars_doNothing$N
y_rates = y_base[2:length(y_base)] - y_base[1:(length(y_base)-1)]
y_rates_byWeek = unlist(lapply(split(y_rates, rep(1:(length(y_base)/7), each=7)), sum))
y_rates
dim(y_rates)
length9y_rates
length(y_rates)
length(y_rates)/7
365/7
364/7
y_rates = c(0, y_base[2:length(y_base)] - y_base[1:(length(y_base)-1)])
y_rates
y_base = rowSums(model_out[, pars_doNothing$D_ids])#/pars_doNothing$N
y_rates = y_base[2:length(y_base)] - y_base[1:(length(y_base)-1)]
y_rates = y_rates[-length(y_rates)] #because years aren't multiples of 7
y_rates_byWeek = unlist(lapply(split(y_rates, rep(1:(length(y_base)/7), each=7)), sum))
y_rates_byWeek
NYC
# Get Data
# TODO: Figre out parameters, figure out initial conditions, and fit specifics
NYC = read.csv('C://Users/czhao/Documents/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/data/nyc.csv')
NYC
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
1/Inf
source('C:/Users/czhao/SELF/GT/BME6780/Heart Transplant/Work/Generated tile metadata/tile metadata.R')
