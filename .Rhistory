source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman COVID collab/Serological_Shielding/reorg/utils.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman COVID collab/Serological_Shielding/reorg/input.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/input.R')
source('reorg/utils.R')
source('CYZ_reorg/utils.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/input.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/input_SD_Simulations.R')
rm(list=ls())
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/input_SD_Simulations.R')
pars
pars_default
pars = pars_default
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/input_Sweep_CalibratedModel_knnfigedits - Copy.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/input_Sweep_CalibratedModel_knnfigedits - Copy.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/input_SD_Simulations.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
# NYC
temp.nyc = read.csv('C:/Users/czhao/Documents/CYZ GITHUB/Weitz Group/COVID-19/SERO_DATA/Deaths data/nyc.csv')
temp.nyc
source('readxl')
require('readxl')
temp.nyc = read_xlsx('C:/Users/czhao/Documents/CYZ GITHUB/Weitz Group/COVID-19/SERO_DATA/Deaths data/SAH orders by location.xlsx')
temp.nyc
# SAH orders
temp.SAH = read_xlsx('C:/Users/czhao/Documents/CYZ GITHUB/Weitz Group/COVID-19/SERO_DATA/Deaths data/SAH orders by location.xlsx')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/input_fits.R')
temp.age
pars$agestruc
pars_default
pars_nyc['agefrac.0'] = NULL
pars_nyc = pars_default
pars_nyc['agefrac.0'] = NULL
names(pars_nyc)
pars_nyc$agestruc
temp.nyc
temp.age
temp.age[temp.age$Location=='NYC',]
temp.age[temp.age$Location=='NYC',3]
unlist(temp.age[temp.age$Location=='NYC',3])
as.vectortemp.age[temp.age$Location=='NYC',3])
as.vector(temp.age[temp.age$Location=='NYC',3])
as.vector(unlist(temp.age[temp.age$Location=='NYC',3]))
sum(temp.age[temp.age$Location=='NYC',4])
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/input_fits.R')
as.vector(unlist(temp.age[temp.age$Location=='NYC',3]))
pars_nyc['agestruc']
pars_nyc = pars_default
pars_nyc['agestruc']
pars_nyc['agestruc'] = as.vector(unlist(temp.age[temp.age$Location=='NYC',3]))
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/input_fits.R')
pars_nyc
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/input_fits.R')
pars_nyc
temp.nyc
temp.nyc[1,2]
as.date(temp.nyc[1,2])
date(temp.nyc[1,2])
Date(temp.nyc[1,2])
?date
as.Date(temp.nyc[1,2])
as.Date(temp.nyc[1,2]) - as.Date('2020-01-01')
as.numeric(as.Date(temp.nyc[1,2]) - as.Date('2020-01-01'))
as.numeric(as.Date(temp.nyc[1,2]) - as.Date('2020-01-01'))/7
as.numeric(as.Date(temp.nyc[1,2]) - as.Date('2020-01-01'))/7+1
as.Date(temp.nyc[,2]) - as.Date('2020-01-01')
as.numeric(as.Date(temp.nyc[,2]) - as.Date('2020-01-01'))
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/input_fits.R')
temp.nyc
pars
pars_nyc
pars_nyc[['nDays']] = max(temp.nyc$wk)*7
pars_nyc[['times']] = 1:pars_nyc$nDays
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/input_fits.R')
pars_nyc
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/input_fits.R')
temp.SAH
temp.SAH[2,]
View(temp.SAH)
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/input_fits.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/input_fits.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/input_fits.R')
df.SAH['nyc', 'tStart_distancing']
df.SAH
rownames(df.SAH) = c('tStart_distancing', 'tStop_distancing')
df.SAH = data.frame('wash' = c('2020-03-16', '2020-05-31')
, 'nyc' = c('2020-03-16', '2020-06-08')
, 'miami' = c('2020-03-17', '2020-05-20')
, 'miss' = c('2020-04-06', '2020-05-03')
, 'utah' = c('2020-03-17', '2020-05-01')
, 'conn' = c('2020-03-23', '2020-05-20'))
rownames(df.SAH) = c('tStart_distancing', 'tStop_distancing')
df.SAH['tStart_distancing', 'nyc']
1+(as.Date(df.SAH['tStart_distancing', 'nyc'])-as.Date('2020-01-01'))
as.numeric(1+(as.Date(df.SAH['tStart_distancing', 'nyc'])-as.Date('2020-01-01')))
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/input_fits.R')
pars_nyc
temp.nyc
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/input_fits.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/input_fits.R')
v.nyc
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/input_fits.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
y_rates
y_rates_byWeek
plot(pars_nyc$times, y_rates_byWeek)
plot(pars_nyc$times[-1], y_rates_byWeek)
plot(y_rates_byWeek)
plot(pars_nyc$observed)
X0
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/input_default.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/input_default.R')
X0
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/input_default.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/input_default.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/input_fits.R')
X0 = Get_Inits(pars_nyc)
X0
sum(X0)
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/input_fits.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/input_default.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
v.obs = pars_nyc$observed
v.obs
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
pars = pars_default
pars[['R0']] = theta[0]
pars[['q']] = theta[1]
# Run Model
model_out = ode(y = X
, times = pars_nyc$times
, fun = seir_model_shields_rcfc_nolatent
, parms = pars_nyc
, method='ode45')
# Run Model
model_out = ode(y = X0
, times = pars_nyc$times
, fun = seir_model_shields_rcfc_nolatent
, parms = pars_nyc
, method='ode45')
model_out = as.data.frame(model_out)[,-1]
model_out
# Extract weekly rates
y_base = rowSums(model_out[, pars_nyc$D_ids])#/pars_nyc$N
y_base
y_rates = y_base[2:length(y_base)] - y_base[1:(length(y_base)-1)]
y_rates
y_rates = y_rates[-length(y_rates)] #because years aren't multiples of 7
y_rates
v.model = unlist(lapply(split(y_rates, rep(1:(length(y_base)/7), each=7)), sum))
y_rates = y_base[2:length(y_base)] - y_base[1:(length(y_base)-1)]
#y_rates = y_rates[-length(y_rates)] #because years aren't multiples of 7
v.model = unlist(lapply(split(y_rates, rep(1:(length(y_base)/7), each=7)), sum))
lengtH(y_rates)
length(y_rates)
length(y_rates)/7
(2_length(y_rates))/7
(2+length(y_rates))/7
(1+length(y_rates))/7
# Extract weekly rates
y_base = rowSums(model_out[, pars_nyc$D_ids])#/pars_nyc$N
y_rates = y_base[2:length(y_base)] - y_base[1:(length(y_base)-1)]
y_rates = c(0, y_rates) #because years aren't multiples of 7
v.model = unlist(lapply(split(y_rates, rep(1:(length(y_base)/7), each=7)), sum))
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
v.obs_frac
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
warnings()
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
fun()
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
warnings()
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
seir_model_shields_rcfc_nolatent
v.obs_rate
v.obs
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
pars_nyc[['q']]
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
warnings()
v.obs
pars_nyc = pars_default
pars_nyc[['q']] = exp(theta[1])
#psi = theta[2]
#rho = theta[2]
# Run Model
model_out = ode(y = X
, times = pars_nyc$times
, fun = seir_model_shields_rcfc_nolatent
, parms = pars_nyc
, method='ode45')
model_out = as.data.frame(model_out)[,-1]
# Extract new cases by day
y_model_byDay = rowSums(model_out[, pars_nyc$D_ids])
y_rates = y_model_byDay[2:length(y_model_byDay)] - y_model_byDay[1:(length(y_model_byDay)-1)]
y_rates = c(0, y_rates)
# Aggregate by week
v.model = unlist(lapply(split(y_rates, rep(1:(length(y_model_byDay)/7), each=7)), sum))
# Likelihood of v.obs given v.model
log_like = dnbinom(y, psi, mu=rho*v.model+tolerance, log=TRUE)
pars_nyc = pars_default
pars_nyc[['q']] = .1
#psi = theta[2]
#rho = theta[2]
# Run Model
model_out = ode(y = X0
, times = pars_nyc$times
, fun = seir_model_shields_rcfc_nolatent
, parms = pars_nyc
, method='ode45')
model_out = as.data.frame(model_out)[,-1]
# Extract new cases by day
y_model_byDay = rowSums(model_out[, pars_nyc$D_ids])
y_rates = y_model_byDay[2:length(y_model_byDay)] - y_model_byDay[1:(length(y_model_byDay)-1)]
y_rates = c(0, y_rates)
log_like = dnbinom(y, psi, mu=rho*v.model+tolerance, log=TRUE)y_rates
y_rates
pars_nyc$times
rm(list=ls())
require(MCMCpack)
# Get Pars and Inits
source('C:/Users/czhao/Documents/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/input_fits.R')
X0 = Get_Inits(pars_nyc)
# Observed Data
v.obs = pars_nyc$observed
v.obs_rate = c(0,v.obs[2:length(v.obs)] - v.obs[1:(length(v.obs)-1)])
# TODO: Figre out parameters, figure out initial conditions, and fit specifics
psi = 1 #overdispersion parameter
rho = 0.9 #reporting rate
tolerance = 1e-20
## negative binomial regression with an improper unform prior
## X and y are passed as args to MCMCmetrop1R
seir_err = function(theta, y, X){
print(theta)
pars_nyc[['q']] = exp(theta[1])
#psi = theta[2]
#rho = theta[2]
# Run Model
model_out = ode(y = X
, times = pars_nyc$times
, fun = seir_model_shields_rcfc_nolatent
, parms = pars_nyc
, method='ode45')
model_out = as.data.frame(model_out)[,-1]
# Extract new cases by day
y_model_byDay = rowSums(model_out[, pars_nyc$D_ids])
y_rates = y_model_byDay[2:length(y_model_byDay)] - y_model_byDay[1:(length(y_model_byDay)-1)]
y_rates = c(0, y_rates)
# Aggregate by week
v.model = unlist(lapply(split(y_rates, rep(1:(length(y_model_byDay)/7), each=7)), sum))
# Likelihood of v.obs given v.model
log_like = dnbinom(y, psi, mu=rho*v.model+tolerance, log=TRUE)
print(sum(log_like))
return(sum(log_like))
}
pars_nyc = pars_default
pars_nyc[['q']] = .1
#psi = theta[2]
#rho = theta[2]
# Run Model
model_out = ode(y = X0
, times = pars_nyc$times
, fun = seir_model_shields_rcfc_nolatent
, parms = pars_nyc
, method='ode45')
model_out = as.data.frame(model_out)[,-1]
# Extract new cases by day
y_model_byDay = rowSums(model_out[, pars_nyc$D_ids])
y_rates = y_model_byDay[2:length(y_model_byDay)] - y_model_byDay[1:(length(y_model_byDay)-1)]
y_rates = c(0, y_rates)
# Aggregate by week
v.model = unlist(lapply(split(y_rates, rep(1:(length(y_model_byDay)/7), each=7)), sum))
# Likelihood of v.obs given v.model
log_like = dnbinom(y, psi, mu=rho*v.model+tolerance, log=TRUE)
y_rates
pars_nyc$times
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/input_fits.R')
rm(list=ls())
require(MCMCpack)
# Get Pars and Inits
source('C:/Users/czhao/Documents/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/input_fits.R')
X0 = Get_Inits(pars_nyc)
# Observed Data
v.obs = pars_nyc$observed
v.obs_rate = c(0,v.obs[2:length(v.obs)] - v.obs[1:(length(v.obs)-1)])
# TODO: Figre out parameters, figure out initial conditions, and fit specifics
psi = 1 #overdispersion parameter
rho = 0.9 #reporting rate
tolerance = 1e-20
## negative binomial regression with an improper unform prior
## X and y are passed as args to MCMCmetrop1R
seir_err = function(theta, y, X){
print(theta)
pars_nyc[['q']] = exp(theta[1])
#psi = theta[2]
#rho = theta[2]
# Run Model
model_out = ode(y = X
, times = pars_nyc$times
, fun = seir_model_shields_rcfc_nolatent
, parms = pars_nyc
, method='ode45')
model_out = as.data.frame(model_out)[,-1]
# Extract new cases by day
y_model_byDay = rowSums(model_out[, pars_nyc$D_ids])
y_rates = y_model_byDay[2:length(y_model_byDay)] - y_model_byDay[1:(length(y_model_byDay)-1)]
y_rates = c(0, y_rates)
# Aggregate by week
v.model = unlist(lapply(split(y_rates, rep(1:(length(y_model_byDay)/7), each=7)), sum))
# Likelihood of v.obs given v.model
log_like = dnbinom(y, psi, mu=rho*v.model+tolerance, log=TRUE)
print(sum(log_like))
return(sum(log_like))
}
pars_nyc = pars_default
rm(list=ls())
require(MCMCpack)
# Get Pars and Inits
source('C:/Users/czhao/Documents/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/input_fits.R')
X0 = Get_Inits(pars_nyc)
# Observed Data
v.obs = pars_nyc$observed
v.obs_rate = c(0,v.obs[2:length(v.obs)] - v.obs[1:(length(v.obs)-1)])
# TODO: Figre out parameters, figure out initial conditions, and fit specifics
psi = 1 #overdispersion parameter
rho = 0.9 #reporting rate
tolerance = 1e-20
## negative binomial regression with an improper unform prior
## X and y are passed as args to MCMCmetrop1R
seir_err = function(theta, y, X){
print(theta)
pars_nyc[['q']] = exp(theta[1])
#psi = theta[2]
#rho = theta[2]
# Run Model
model_out = ode(y = X
, times = pars_nyc$times
, fun = seir_model_shields_rcfc_nolatent
, parms = pars_nyc
, method='ode45')
model_out = as.data.frame(model_out)[,-1]
# Extract new cases by day
y_model_byDay = rowSums(model_out[, pars_nyc$D_ids])
y_rates = y_model_byDay[2:length(y_model_byDay)] - y_model_byDay[1:(length(y_model_byDay)-1)]
y_rates = c(0, y_rates)
# Aggregate by week
v.model = unlist(lapply(split(y_rates, rep(1:(length(y_model_byDay)/7), each=7)), sum))
# Likelihood of v.obs given v.model
log_like = dnbinom(y, psi, mu=rho*v.model+tolerance, log=TRUE)
print(sum(log_like))
return(sum(log_like))
}
pars_nyc[['q']] = .1
#psi = theta[2]
#rho = theta[2]
# Run Model
model_out = ode(y = X0
, times = pars_nyc$times
, fun = seir_model_shields_rcfc_nolatent
, parms = pars_nyc
, method='ode45')
model_out = as.data.frame(model_out)[,-1]
# Extract new cases by day
y_model_byDay = rowSums(model_out[, pars_nyc$D_ids])
y_rates = y_model_byDay[2:length(y_model_byDay)] - y_model_byDay[1:(length(y_model_byDay)-1)]
y_rates = c(0, y_rates)
y_rates
dim(y_rates)
length9y_rates
length(y_rates)
length(y_rates)/7
# Aggregate by week
v.model = unlist(lapply(split(y_rates, rep(1:(length(y_model_byDay)/7), each=7)), sum))
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
post.samp
plot(post.samp)
pars_nyc
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
pars_nyc[['q']]
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
post.samp
plot(post.samp)
plot(post.samp[2500:,])
plot(post.samp[2500:])
plot(post.samp[2500:4000])
plot(post.samp[2500:4000,])
plot(post.samp[2500:4000])
hist(post.samp[2500:4000])
save(post.samp, seir_err, psi, rho, tolerance, v.obs_rate, file='2020_07_27-init_fit_q')
save(post.samp, seir_err, psi, rho, tolerance, v.obs_rate, file='2020_07_27-init_fit_q.R')
getwd()
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
th_init = c(.05, .1, .1, .1, .1, .1, .1)
th_min = c(0, 0, 0, 0, 0, 0, 0)
th_max = c(.1, 1, 1, 1, 10, 1, 1e-10)
(th_init > th_min) & (th_init < th_max)
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
test = c(-1, .1, 221, 663, -85, 85)
(test > th_min)&(test < th_max)
prod((test > th_min)&(test < th_max))
!prod((test > th_min)&(test < th_max))
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
th_min = rep(-Inf, 6)
th_max = c(0, 0, 0, 0, 3,0)
th_init = log(th_init)
th_init
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
post.samp = MCMCmetrop1R(seir_err
, theta.init=th_init
, y=v.obs
, X=X0
, mcmc=3000
, burnin=1000
, verbose=100
, logfun=TRUE
, seed=list(NA,1))
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/test_mcmcmetrop1r.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/Sweep_CalibratedModel_knnfigedits.R')
sweep
data.summary
rm(ls=list())
rm(list=ls())
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/utils.R')
source('CYZ_reorg/R/input_default.R')
seir_model_shields_rcfc_nolatent(0, Get_Inits(Pars = pars_default), pars_default)
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/CYZ_reorg/R/utils.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/test_default.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/test_default.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/test_default.R')
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/test_default.R')
test
dim(test)
length(test)
length(test[[1]])
3.1/79.27
3.1/63.28
2.9/63.28
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/test_default.R')
test
source('~/CYZ GITHUB/Weitz Group/COVID-19/Lopman Covid SeroPos/Serological_Shielding/Sweep_CalibratedModel_knnfigedits.R')
